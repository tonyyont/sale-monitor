# Sale Monitor

Find luxury fashion deals across SSENSE, MR PORTER, and 2ndStreet. Automated scraping, parsing, filtering — browse results in an offline HTML viewer.

## What It Does

Pipeline: scrape retailer sale pages → parse product data (brand, prices, discount) → filter by your preferences → browse in a self-contained HTML viewer with sorting, filtering, and batch-open.

## Setup (5 minutes)

### Prerequisites
- **Claude Code** installed ([claude.ai/claude-code](https://claude.ai/claude-code))
- **Firecrawl API key** — sign up at [firecrawl.dev](https://firecrawl.dev). Free tier gives ~500 credits (~35 credits per full run)
  - Add to your shell: `echo 'export FIRECRAWL_API_KEY=fc-YOUR_KEY' >> ~/.zshrc && source ~/.zshrc`
- **Firecrawl CLI**: `npm install -g firecrawl`
- **Python 3** (pre-installed on macOS)

### Get Started
1. Fork & clone this repo
2. Open Claude Code in the repo directory
3. Say: **"help me set up sale-monitor"**
4. Claude walks you through your brands, sizes, and retailers
5. Run your first scrape: `/sale-monitor`

## Supported Retailers

| Retailer | Section | Approach |
|----------|---------|----------|
| **SSENSE** | Men + Women | Per-brand URLs with size filters, sorted by discount |
| **MR PORTER** | Men only | Faceted brand + size filtering |
| **2ndStreet** | Unisex | Japanese secondhand marketplace, JPY auto-converts |

## Customizing Later

Just tell Claude what you want:
- "Add Rick Owens to my brands" — regenerates retailer URLs
- "Switch to women's SSENSE" — updates all SSENSE URLs
- "Change my shoe size to 11" — updates sizes across retailers
- "Disable MR PORTER" — turns off a retailer

## Manual Usage (without Claude Code)

```bash
# Set your API key
export FIRECRAWL_API_KEY=fc-YOUR_KEY

# Scrape all enabled retailers
./scripts/scrape_retailer.sh all

# Or scrape individually
./scripts/scrape_retailer.sh ssense

# Parse results into JSON + HTML viewer
python3 scripts/parse_results.py

# Open the viewer
open viewer/deals.html
```

## How It Works

1. **Scrape** — `scrape_retailer.sh` uses Firecrawl to convert retailer sale pages to markdown (~1 API credit/page)
2. **Parse** — `parse_results.py` routes each file to a per-retailer parser, extracts product data (brand, name, prices, discount, URL, category)
3. **Filter** — Applies discount threshold (default 50%), deduplicates across pages
4. **View** — Generates a self-contained `deals.html` with all data inlined. Filters by store, brand, category, discount, price. Sorting, multi-select, batch-open to retailer pages.

**Cost:** ~35 Firecrawl credits per full run across all retailers. Free tier is 500 credits.

**Dependencies:** Python 3 stdlib only. No pip installs needed.

## Directory Structure

```
sale-monitor/
├── scripts/
│   ├── parse_results.py        # Markdown → JSON parser (multi-retailer)
│   ├── scrape_retailer.sh      # Firecrawl CLI wrapper with pagination
│   └── page_checker.py         # Pagination control (discount/overlap checks)
├── viewer/
│   ├── index.html              # Viewer template (accepts drag-and-drop JSON)
│   └── deals.html              # Self-contained viewer with embedded data (generated)
├── config-templates/           # Example configs for reference
│   ├── preferences.example.json
│   └── retailers/
│       ├── ssense.example.json
│       ├── mrporter.example.json
│       └── 2ndstreet.example.json
├── output/                     # Raw scraped markdown (gitignored)
├── results/                    # Parsed JSON (gitignored)
└── logs/                       # Scrape logs (gitignored)

# User config lives here (generated by setup wizard):
~/.claude/skills/sale-monitor/config/
├── preferences.json
└── retailers/
    ├── ssense.json
    ├── mrporter.json
    └── 2ndstreet.json
```

## JSON Output Shape

```json
{
  "meta": {
    "scraped_at": "2026-02-07T01:31:26Z",
    "retailers": ["mrporter", "ssense"],
    "total_parsed": 254,
    "total_filtered": 133,
    "min_discount_pct": 50
  },
  "products": [
    {
      "brand": "UNDERCOVER",
      "name": "Off-White Crinkled Cargo Pants",
      "sale_price": 138,
      "original_price": 690,
      "discount_pct": 80,
      "url": "https://www.ssense.com/...",
      "retailer": "ssense",
      "image_url": null,
      "category": "bottoms"
    }
  ]
}
```
